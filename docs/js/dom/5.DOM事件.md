## å…³äºäº‹ä»¶çš„ä¸€äº›æ¦‚å¿µ

1. äº‹ä»¶æº: äº‹ä»¶å‘ç”Ÿåœ¨å“ªä¸ªå…ƒç´ èŠ‚ç‚¹å¯¹è±¡ä¸Š, è°å°±æ˜¯è¿™ä¸ªäº‹ä»¶çš„äº‹ä»¶æº
2. äº‹ä»¶å¤„ç†å‡½æ•°: å…ƒç´ èŠ‚ç‚¹æœ¬èº«å°±æ˜¯æœ‰äº‹ä»¶çš„, ç»‘å®šäº‹ä»¶: æ˜¯æŒ‡æ·»åŠ äº‹ä»¶å¤„ç†å‡½æ•°, å½“è¿™ä¸ªäº‹æƒ…å‘ç”Ÿäº†ä¹‹å, åº”è¯¥åšä»€ä¹ˆ?
3. äº¤äº’è¡Œä¸º: è§¦å‘äº‹ä»¶(æ¯”å¦‚ç‚¹å‡») + äº‹ä»¶çš„åé¦ˆ

## ç»‘å®šäº‹ä»¶

> ç»‘å®šäº‹ä»¶,ç»‘å®šäº‹ä»¶å¤„ç†å‡½æ•°, ç›‘å¬äº‹ä»¶å…¶å®è¯´çš„éƒ½æ˜¯ä¸€å›äº‹, å°±æ˜¯å½“å‘ç”Ÿä¸€ä¸ªäº‹ä»¶çš„æ—¶å€™, ç¨‹åºå¦‚ä½•å¤„ç†?
> æ¯”å¦‚: å½“æˆ‘ç‚¹å‡»æŒ‰é’®çš„æ—¶å€™, åº”è¯¥å» "ä¸‹è½½æ–‡ä»¶", é‚£ä¹ˆå®ç°ä¸‹è½½æ–‡ä»¶çš„è¿™ä¸ªåŠŸèƒ½çš„å°±æ˜¯æŒ‰é’®ç‚¹å‡»äº‹ä»¶çš„å¤„ç†å‡½æ•°

1. å¥æŸ„ç»‘å®šäº‹ä»¶(åŒ…æ‹¬æ ‡ç­¾è¡Œå†…çš„ç»‘å®šäº‹ä»¶:`å†…è”/è¡Œå†…äº‹ä»¶ç›‘å¬å™¨`)
   1. åŒä¸€ä¸ªçš„äº‹ä»¶åªèƒ½ç»‘å®šä¸€æ¬¡, ç»‘å®šå¤šæ¬¡ä¼šè¦†ç›–
   2. js ä»£ç ç»‘å®šçš„äº‹ä»¶æ¯”è¡Œå†…ç»‘å®šçš„æ–¹å¼ä¼˜å…ˆçº§é«˜
   3. å¯ä»¥ç›´æ¥æŠŠä»£ç å†™åˆ°æ ‡ç­¾ä¸Š
   4. åªèƒ½ç›‘å¬ `å†’æ³¡é˜¶æ®µ`,æ— æ³•ç›‘å¬ `æ•è·é˜¶æ®µ`
2. addEventListener æ–¹æ³•ç»‘å®šäº‹ä»¶(æ¨è ğŸ‘)
   1. IE9 ä»¥ä¸‹ä¸æ”¯æŒè¿™ç§æ–¹å¼ç»‘å®š
   2. åŒä¸€ä¸ªç±»å‹çš„äº‹ä»¶,å¯ä»¥ç»‘å®šå¤šä¸ªäº‹ä»¶å¤„ç†å‡½æ•°
   3. w3c DOM è§„èŒƒçš„æ³¨å†Œ/ç»‘å®šäº‹ä»¶çš„æ–¹å¼
   4. æ—¢å¯ä»¥ç›‘å¬ `å†’æ³¡é˜¶æ®µ`åˆå¯ä»¥ç›‘å¬ `æ•è·é˜¶æ®µ`, å…·ä½“çœ‹ç¬¬ä¸‰ä¸ªå‚æ•° [mdn æ–‡æ¡£](https://developer.mozilla.org/en-US/docs/Web/API/EventTarget/addEventListener#parameters)
3. attchEvent æ–¹æ³•ç»‘å®š:
   1. IE8 åŠä»¥ä¸‹ä½ç‰ˆæœ¬çš„æµè§ˆå™¨æ”¯æŒ, chrom æ˜¯æ²¡æœ‰çš„

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <title>js</title>
    <style type="text/css">
      #app {
        background: black;
        width: 100px;
        height: 100px;
      }
    </style>
  </head>
  <body>
    <div id="app" onclick="test" onmouseenter="console.log(1)"></div>

    <!-- javascript -->
    <script>
      function test() {
        console.log(1);
      }

      var app = document.getElementById("app");
      app.onclick = function () {
        console.info("click handler"); // æ‰§è¡Œäº†è¿™ä¸ª, è¯æ˜jsç»‘å®šçš„äº‹ä»¶ä¼˜å…ˆçº§é«˜äºå†…è”äº‹ä»¶ç›‘å¬å™¨, è€Œä¸”åªèƒ½ç»‘å®šä¸€æ¬¡
      };
    </script>
  </body>
</html>
```

### å…¼å®¹ä½ç‰ˆæœ¬æµè§ˆå™¨åšæ³•:

å…¼å®¹ä½ç‰ˆæœ¬æµè§ˆå™¨åšæ³•: è¿™é‡Œä½¿ç”¨äº†æƒ°æ€§å‡½æ•°, å¯ä»¥å‚è€ƒ:

```javascript
/**
 * å…¼å®¹: æ·»åŠ äº‹ä»¶å¤„ç†å‡½æ•°
 * @param {HTMLElement} el äº‹ä»¶æº
 * @param {String} type äº‹ä»¶ç±»å‹
 * @param {Function} handler äº‹ä»¶å¤„ç†å‡½æ•°
 * @returns
 */
function addEvent(el, type, handler) {
  if (el.addEventListener) {
    addEvent = function (el, type, handler) {
      el.addEventListener(type, handler, false);
    };
  } else if (el.attachEvent) {
    addEvent = function (el, type, handler) {
      el.attachEvent("on" + type, function () {
        handler.call(el);
      });
    };
  } else {
    addEvent = function (el, type, handler) {
      el["on" + type] = handler;
    };
  }
  return addEvent(el, type, handler); // åªæœ‰è¿™ä¸€æ¬¡æ‰§è¡Œä¼šåˆ¤æ–­
}

/**
 * å…¼å®¹: ç§»é™¤äº‹ä»¶å¤„ç†å‡½æ•°
 * @param {HTMLElement} el äº‹ä»¶æº
 * @param {String} type äº‹ä»¶ç±»å‹
 * @returns
 */
function removeEvent(el, type, handler) {
  if (el.removeEventListener) {
    removeEvent = function (el, type, handler) {
      el.removeEventListener(type, handler);
    };
  } else if (el.detachEvent) {
    removeEvent = function (el, type, handler) {
      el.detachEvent("on" + type, handler);
    };
  } else {
    removeEvent = function (el, type, handler) {
      el["on" + type] = null;
    };
  }
  return removeEvent(el, type, handler); // åªæœ‰è¿™ä¸€æ¬¡æ‰§è¡Œä¼šåˆ¤æ–­
}
```

### é¢è¯•é¢˜:

é—­åŒ…é—®é¢˜: å¤ä¹ é—­åŒ…é‚£ä¸€èŠ‚çš„ç¬”è®° [https://www.yuque.com/liaohui5/js-base/fepwdu](https://www.yuque.com/liaohui5/js-base/fepwdu)
Q: ä»¥ä¸‹ä»£ç , æ§åˆ¶å°ä¼šè¾“å‡ºä»€ä¹ˆ? ä¸ºä»€ä¹ˆ?
A: è¾“å‡º 5 ä¸ª A, è¿ç»´ç»‘å®šäº‹ä»¶å¤„ç†å‡½æ•°æ˜¯, è¿™ä¸ªå‡½æ•°å¹¶æ²¡æœ‰æ‰§è¡Œ, æ‰€ä»¥æœ€åæ‰§è¡Œçš„æ—¶å€™, è·å– i çš„å€¼æ˜¯ for å¾ªç¯æ‰§è¡Œç©ä¹‹åçš„å€¼

Q: å¦‚æœæƒ³è®©å®ƒè¾“å‡ºå¯¹åº”åºå·åº”è¯¥æ€ä¹ˆåš??
A: å¦‚æœæ˜¯ ES6, ç›´æ¥æŠŠ `var i = 0` ä¿®æ”¹ä¸º `let i = 0` å°±å¯ä»¥, å› ä¸º `let` å…³é”®å­—æ²¡æœ‰å˜é‡æå‡çš„é—®é¢˜
å¦‚æœæ˜¯ ES3, åœ¨å¾ªç¯çš„æ—¶å€™ç”¨ `é—­åŒ…` å»ä¿å­˜ i å˜é‡çš„å€¼, ç„¶åå†ç»‘å®šäº‹ä»¶å°±æ²¡æœ‰é—®é¢˜äº†

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <title>js</title>
  </head>
  <body>
    <ul>
      <li>1</li>
      <li>2</li>
      <li>3</li>
      <li>4</li>
      <li>5</li>
    </ul>

    <!-- javascript -->
    <script>
      var lis = document.getElementsByTagName("li");
      var item;
      for (var i = 0, len = lis.length; i < len; i++) {
        item = lis[i];
        item.addEventListener(
          "click",
          function () {
            console.info(i);
          },
          false
        );

        // å¦‚æœæƒ³æ‹¿åˆ°å¯¹åº” i çš„å€¼:
        // (function(i) {
        //  item = lis[i];
        //  item.addEventListener('click', function() {
        //    console.info(i);
        //  }, false);
        // })(i);
      }
    </script>
  </body>
</html>
```

## ç§»é™¤äº‹ä»¶å¤„ç†å‡½æ•°

1. `removeEventListener` æ–¹æ³•
2. `detachEvent` ,å¯¹åº” `attachEvent` æ–¹æ³•
3. `el.onclick = null` å¥æŸ„ç»‘å®šäº‹ä»¶çš„æ–¹å¼é‡æ–°èµ‹å€¼

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <title>js</title>
    <style>
      #app {
        width: 100px;
        height: 100px;
        background: #000;
      }
    </style>
  </head>
  <body>
    <div id="app"></div>

    <!-- javascript -->
    <script>
      var app = document.getElementById("app");

      // ç‚¹å‡»äº‹ä»¶å¤„ç†å‡½æ•°
      var clickHandler = function () {
        // åªä¼šè¾“å‡ºä¸€æ¬¡, å› ä¸ºè¾“å‡ºä»¥å, è¿™ä¸ªäº‹ä»¶å°±è¢«ç§»é™¤äº†
        console.info("clicked");
        // ç‚¹å‡»äº‹ä»¶å¤„ç†å‡½æ•°
        this.removeEventListener("click", clickHandler);
      };

      // é¼ æ ‡åˆ’å…¥äº‹ä»¶å¤„ç†å‡½æ•°
      var mouseEnterHandler = function () {
        console.info("move enter");
        // ç§»é™¤é¼ æ ‡åˆ’å…¥äº‹ä»¶å¤„ç†å‡½æ•°
        this.onmouseenter = null;
      };

      app.addEventListener("click", clickHandler, false);
      app.onmouseenter = mouseEnterHandler;
    </script>
  </body>
</html>
```

## äº‹ä»¶æ•è·ç°è±¡ & äº‹ä»¶å†’æ³¡ç°è±¡

[W3C å®˜æ–¹æ–‡æ¡£](https://www.w3.org/TR/DOM-Level-3-Events/#event-flow)

![123.png](https://raw.githubusercontent.com/liaohui5/images/main/images/202311300131347.png)

### äº‹ä»¶å†’æ³¡ event bubbling

å½“ä¸€ä¸ªäº‹ä»¶å‘ç”Ÿåœ¨ä¸€ä¸ªå…ƒç´ ä¸Šï¼Œå®ƒä¼šé¦–å…ˆè¿è¡Œåœ¨è¯¥å…ƒç´ ä¸Šçš„å¤„ç†ç¨‹åºï¼Œ
ç„¶åè¿è¡Œå…¶çˆ¶å…ƒç´ ä¸Šçš„å¤„ç†ç¨‹åºï¼Œç„¶åä¸€ç›´å‘ä¸Šåˆ°å…¶ä»–ç¥–å…ˆä¸Šçš„å¤„ç†ç¨‹åºã€‚

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <title>js</title>
    <style>
      #wrapper {
        width: 300px;
        height: 300px;
        background: red;
      }
      #outer {
        width: 200px;
        height: 200px;
        background: green;
        margin-left: 300px;
      }
      #inner {
        width: 100px;
        height: 100px;
        background-color: blue;
        margin-left: 200px;
      }
    </style>
  </head>
  <body>
    <div id="wrapper">
      <div id="outer">
        <div id="inner"></div>
      </div>
    </div>

    <!-- javascript -->
    <script>
      var wrapper = document.getElementById("wrapper");
      var outer = document.getElementById("outer");
      var inner = document.getElementById("inner");
      var useCapture = false;

      wrapper.addEventListener(
        "click",
        function () {
          console.info("wrapper");
        },
        useCapture
      );

      outer.addEventListener(
        "click",
        function () {
          console.info("outer");
        },
        useCapture
      );

      inner.addEventListener(
        "click",
        function () {
          console.info("inner");
        },
        useCapture
      );
    </script>
  </body>
</html>
```

![Sep-14-2021 21-52-11.gif](https://raw.githubusercontent.com/liaohui5/images/main/images/202311300132828.gif)

![line-box.gif](https://raw.githubusercontent.com/liaohui5/images/main/images/202311300132443.gif)

### äº‹ä»¶æ•è· event capturing

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <title>js</title>
    <style>
      #wrapper {
        width: 300px;
        height: 300px;
        background: red;
      }
      #outer {
        width: 200px;
        height: 200px;
        background: green;
        margin-left: 300px;
      }
      #inner {
        width: 100px;
        height: 100px;
        background-color: blue;
        margin-left: 200px;
      }
    </style>
  </head>
  <body>
    <div id="wrapper">
      <div id="outer">
        <div id="inner"></div>
      </div>
    </div>

    <!-- javascript -->
    <script>
      var wrapper = document.getElementById("wrapper");
      var outer = document.getElementById("outer");
      var inner = document.getElementById("inner");
      var useCapture = true;

      wrapper.addEventListener(
        "click",
        function () {
          console.info("wrapper");
        },
        useCapture
      );

      outer.addEventListener(
        "click",
        function () {
          console.info("outer");
        },
        useCapture
      );

      inner.addEventListener(
        "click",
        function () {
          console.info("inner");
        },
        useCapture
      );
    </script>
  </body>
</html>
```

![capture.gif](https://raw.githubusercontent.com/liaohui5/images/main/images/202311300133973.gif)

### addEventListener çš„ç¬¬ä¸‰ä¸ªå‚æ•°çš„ä½œç”¨

[MDN æ–‡æ¡£](https://developer.mozilla.org/zh-CN/docs/Web/API/EventTarget/addEventListener): `addEventListener(type, handler, useCapture || options)`

1. type: å­—ç¬¦ä¸², ç»‘å®šçš„äº‹ä»¶ç±»å‹
2. handler: å‡½æ•°, äº‹ä»¶å¤„ç†å‡½æ•°
3. useCpature: å¸ƒå°”å€¼, æŒ‡å®šå¤„ç†å‡½æ•°å®åœ¨å“ªä¸ªé˜¶æ®µæ‰§è¡Œ `true: äº‹ä»¶æ•è·` `false: äº‹ä»¶å†’æ³¡`
4. [options: å¯¹è±¡](https://developer.mozilla.org/zh-CN/docs/Web/API/EventTarget/addEventListener#options)
   1. options.captcha: é»˜è®¤ false, æ˜¯å¦ç›‘å¬æ•è·é˜¶æ®µ
   2. options.once: é»˜è®¤ false, æ‰§è¡Œä¸€æ¬¡ç›‘å¬å‡½æ•°åå°±ç§»é™¤ç›‘å¬å‡½æ•°
   3. options.passive: é»˜è®¤ false, ä½†æ˜¯éƒ¨åˆ†æµè§ˆå™¨ç»™ `window, document, document.body`çš„æŸä¸€äº›äº‹ä»¶(æ¯”å¦‚: `touchstart`)åšäº†æ€§èƒ½ä¼˜åŒ–, å°†é»˜å€¼æ”¹ä¸ºäº† `true`, å½“å€¼ä¸º true çš„æ—¶å€™, å°±æ— æ³•è°ƒç”¨, `preventDefault()`æ–¹æ³•(`ä¼šæŠ›å‡ºå¼‚å¸¸`), ä¹Ÿå°±æ˜¯è¯´ `passive ä¸º true å°±æ— æ³•é˜»æ­¢é»˜è®¤è¡Œä¸º`

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>æµ‹è¯• Event å¯¹è±¡çš„ isTrusted å±æ€§</title>
    <style>
      #app {
        margin: 0;
        padding: 0;
        width: 100%;
        height: 1500px;
      }
    </style>
  </head>
  <body>
    <div id="app">å¯æ»šåŠ¨å†…å®¹</div>
    <script>
      var app = document.querySelector("#app");
      // app çš„ touchstart äº‹ä»¶ç›‘å¬å‡½æ•°å¯ä»¥æ­£å¸¸æ‰§è¡Œ
      app.addEventListener("touchstart", function (e) {
        e.preventDefault();
        console.log("[app] e.defaultPrevented: ", e.defaultPrevented);
      });

      // document çš„ touchstart äº‹ä»¶ç›‘å¬å‡½ä¼šæŠ›å‡ºå¼‚å¸¸:
      document.addEventListener("touchstart", function (e) {
        // [Intervention] Unable to preventDefault inside passive event listener due to target being treated as passive.
        // See https://www.chromestatus.com/feature/5093566007214080
        e.preventDefault();
        console.log("[app] e.defaultPrevented: ", e.defaultPrevented);
      });

      /***************************************
ä¸ºä»€ä¹ˆ passive å‚æ•°è®¾ç½®ä¸º true èƒ½å¤ŸæŒºé«˜æ»šå±æ€§èƒ½?

function handler(e) {
  // 1. touchstart çš„é»˜è®¤è¡Œä¸ºæ˜¯æ»šåŠ¨
  // 2. äº‹ä»¶ç›‘å¬å‡½æ•°çš„æ‰§è¡Œé¡ºåº:
  //    2.1 å…ˆæ‰§è¡Œ handler
  //    2.2 ç„¶åæ‰§è¡Œé»˜è®¤è¡Œä¸º
  console.log("handler-exec");
}

document.addEventListener('touchstart', handler, { passive: true });


passive å‚æ•°è®¾ç½®ä¸º true èƒ½å¤ŸæŒºé«˜æ»šå±æ€§èƒ½çš„åŸå› :
1. é˜»æ­¢é»˜è®¤è¡Œä¸ºçš„æ–¹æ³•ä¸ä¼šè°ƒç”¨( preventDefault() )
2. ç”¨ä¸¤çº¿ç¨‹å‡ºå¤„ç†é—®é¢˜, ä¸€ä¸ªå¤„ç†äº‹ä»¶ç›‘å¬å‡½æ•°, ä¸€ä¸ªå¤„ç†é»˜è®¤è¡Œä¸º
***************************************/
    </script>
  </body>
</html>
```

### æ•è·å’Œå†’æ³¡çš„æ‰§è¡Œé¡ºåº

1. å…¶ä»–å…ƒç´ èŠ‚ç‚¹: å…ˆæ•è·, åå†’æ³¡
2. äº‹ä»¶æºå…ƒç´ èŠ‚ç‚¹: è°å…ˆç»‘å®š, è°å…ˆæ‰§è¡Œ
3. äº‹ä»¶æ•è·å’Œå†’æ³¡çš„æ‰§è¡Œé¡ºåºéƒ½æ˜¯æŒ‰ç…§ DOM ç»“æ„æ¥è§¦å‘çš„, è·Ÿè° js ç›‘å¬ä»£ç åœ¨å‰, è°åœ¨åæ²¡æœ‰å…³ç³»

![myflow.png](https://raw.githubusercontent.com/liaohui5/images/main/images/202311300133336.png)

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <title>js</title>
    <style>
      #wrapper {
        width: 300px;
        height: 300px;
        background: red;
      }
      #outer {
        width: 200px;
        height: 200px;
        background: green;
        margin-left: 300px;
      }
      #inner {
        width: 100px;
        height: 100px;
        background-color: blue;
        margin-left: 200px;
      }
    </style>
  </head>
  <body>
    <div id="wrapper">
      wrapper
      <div id="outer">
        outer
        <div id="inner">inner</div>
      </div>
    </div>

    <!-- javascript -->
    <script>
      var wrapper = document.getElementById("wrapper");
      var outer = document.getElementById("outer");
      var inner = document.getElementById("inner");

      // ----------------------------- inner ------------------------------//
      inner.addEventListener(
        "click",
        function () {
          console.info("inner capture");
        },
        true
      );
      inner.addEventListener(
        "click",
        function () {
          console.info("inner bubble");
        },
        false
      );

      // ----------------------------- wrapper ------------------------------//
      wrapper.addEventListener(
        "click",
        function () {
          console.info("wrapper capture");
        },
        true
      );
      wrapper.addEventListener(
        "click",
        function () {
          console.info("wrapper bubble");
        },
        false
      );

      // ----------------------------- outer ------------------------------//
      outer.addEventListener(
        "click",
        function () {
          console.info("outer capture");
        },
        true
      );
      outer.addEventListener(
        "click",
        function () {
          console.info("outer bubble");
        },
        false
      );
    </script>
  </body>
</html>
```

![useCpature.gif](https://raw.githubusercontent.com/liaohui5/images/main/images/202311300134786.gif)

## å–æ¶ˆå†’æ³¡/é˜»æ­¢æµè§ˆå™¨é»˜è®¤äº‹ä»¶

### å–æ¶ˆ(åœæ­¢)å†’æ³¡

æœ‰æ—¶å€™æˆ‘ä»¬å¹¶ä¸éœ€è¦è¿™æ ·çš„å†’æ³¡, æ‰€ä»¥å°±éœ€è¦æ‰‹åŠ¨çš„å»åœæ­¢å†’æ³¡

```javascript
/**
 * å–æ¶ˆå†’æ³¡
 * @param {Event} e
 * @returns
 */
function cancelBubble(e) {
  if (e.stopPropagation) {
    cancelBubble = function (e) {
      e = e || window.event;
      return e.stopPropagation();
    };
  } else {
    cancelBubble = function (e) {
      e = e || window.event; // window.event å…¼å®¹ie8åŠå…¶ä»¥ä¸‹ç‰ˆæœ¬çš„æµè§ˆå™¨
      e.cancelBubble = true;
    };
  }

  return cancelBubble(e); // åªä¼šåˆ¤æ–­è¿™ä¸€æ¬¡
}
```

### é˜»æ­¢æµè§ˆå™¨é»˜è®¤äº‹ä»¶

æµè§ˆå™¨é»˜è®¤æœ‰å¾ˆå¤šäº‹ä»¶: æ¯”å¦‚ç‚¹å‡» a æ ‡ç­¾å°±ç›´æ¥è·³è½¬äº†, æ¯”å¦‚ç‚¹å‡»é¼ æ ‡å³é”®ä¼šå‡ºç°ä¸€ä¸ªèœå•, æ¯”å¦‚ç‚¹å‡»è¡¨å•ä¸­çš„æŒ‰é’®ä¼šç›´æ¥æäº¤è¡¨å•

```javascript
// å–æ¶ˆæµè§ˆå™¨é»˜è®¤äº‹ä»¶
function preventDefault(e) {
  var e = e || widow.event;
  if (e.preventDefault) {
    // w3c standard
    preventDefault = function (e) {
      e.preventDefault(e);
    };
  } else {
    // ie: 9/8/7/6
    preventDefault = function (e) {
      e = e || widow.event;
      e.returnValue = false;
    };
  }
  return preventDefault(e);
}
```

### ä¸èƒ½å†’æ³¡çš„äº‹ä»¶ç±»å‹

| äº‹ä»¶       | è¯´æ˜                            |
| ---------- | ------------------------------- |
| abort      | éŸ³/è§†é¢‘ç»ˆæ­¢åŠ è½½                 |
| resize     | è°ƒæ•´æµè§ˆå™¨çª—å£å¤§å°              |
| error      | é™æ€åŠ è½½å¤±è´¥(æ¯”å¦‚å›¾ç‰‡)          |
| load       | æµè§ˆå™¨åŠ è½½å®Œç½‘é¡µ(window.onload) |
| unload     | æµè§ˆå™¨å…³é—­ç½‘é¡µæ—¶                |
| mouseenter | é¼ æ ‡ç§»å…¥                        |
| mouseleave | é¼ æ ‡ç§»å‡º                        |
| blur       | å¤±å»ç„¦ç‚¹                        |
| focus      | è·å–ç„¦ç‚¹                        |

## Event å¯¹è±¡çš„å…¶ä»–å±æ€§&æ–¹æ³•

### target / currentTarget

target: `å§‹ç»ˆæŒ‡å‘åˆæ¬¡è§¦å‘äº‹ä»¶çš„ DOM å¯¹è±¡, äº‹ä»¶æº`
currentTarget: `æŒ‡å‘å½“å‰è§¦å‘äº‹ä»¶çš„ DOM å¯¹è±¡`

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>æµ‹è¯• Event å¯¹è±¡çš„ target/currentTarget å±æ€§</title>
  </head>
  <body>
    <div id="wrapper">
      <button id="btn">button</button>
    </div>
    <script>
      function handler(e) {
        // ç‚¹å‡»æŒ‰é’®:
        // target: å§‹ç»ˆæŒ‡å‘ #btn
        // currentTarget: ç¬¬ä¸€æ¬¡æŒ‡å‘  #btn, ç„¶åå†’æ³¡, ç¬¬äºŒæ¬¡æŒ‡å‘ #wrapper
        // target å¯ä»¥åšäº‹ä»¶ä»£ç†, è€Œ currentTarget ä¸è¡Œ, å› ä¸ºå†’æ³¡æ—¶, ä»–æŒ‡å‘çš„ DOM å˜äº†
        console.info("target:", e.target);
        console.info("currentTarget:", e.currentTarget);
      }
      document.querySelector("#wrapper").addEventListener("click", handler);
      document.querySelector("#btn").addEventListener("click", handler);
    </script>
  </body>
</html>
```

### [cancelable](https://developer.mozilla.org/zh-CN/docs/Web/API/Event/cancelable) äº‹ä»¶æ˜¯å¦å¯ä»¥é€šè¿‡é˜»æ­¢é»˜è®¤è¡Œä¸ºå–æ¶ˆ

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>æµ‹è¯• Event å¯¹è±¡çš„ cancelable å±æ€§</title>
    <style>
      .scroll-wrapper {
        width: 100%;
        height: 1500px;
      }
    </style>
  </head>
  <body>
    <form action="" id="form">
      <input type="text" />
      <button type="submit">submit form</button>
    </form>
    <div class="scroll-wrapper">è¿™æ˜¯å¯ä»¥æ»šåŠ¨å†…å®¹</div>
    <script>
      function handler(event) {
        if (typeof event.cancelable !== "boolean" || event.cancelable) {
          // å¦‚æœå½“å‰è¢«è§¦å‘çš„äº‹ä»¶å¯ä»¥å–æ¶ˆå°±ç›´æ¥å–æ¶ˆ
          event.preventDefault();
          console.info(event.type + "äº‹ä»¶è¢«å–æ¶ˆäº†", event);
        } else {
          // å¦‚æœä¸èƒ½å–æ¶ˆ
          console.warn(event.type + "äº‹ä»¶ä¸èƒ½å–æ¶ˆ", event);
        }
      }

      document.getElementById("form").addEventListener("submit", handler);
      document.addEventListener("wheel", handler);
    </script>
  </body>
</html>
```

### [bubbles](https://developer.mozilla.org/zh-CN/docs/Web/API/Event/bubbles) å½“å‰äº‹ä»¶æ˜¯å¦ä¼šå‘ DOM æ ‘ä¸Šå±‚å…ƒç´ å†’æ³¡

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>æµ‹è¯• Event å¯¹è±¡çš„ bubbles å±æ€§</title>
  </head>
  <body>
    <div id="div">
      <input type="text" id="ipt" />
      <button id="btn">button</button>
    </div>
    <script>
      function handler(e) {
        console.info(e);
        if (typeof e.bubbles === "boolean" && e.bubbles) {
          console.info(`${e.type} äº‹ä»¶ä¼šå‘ä¸Šå†’æ³¡`, e);
        } else {
          console.warn(`${e.type} äº‹ä»¶ä¸ä¼šå‘ä¸Šå†’æ³¡`, e);
        }
      }

      function $(selector) {
        return document.querySelector(selector);
      }

      // focus äº‹ä»¶ä¸ä¼šå‘ä¸Šå†’æ³¡
      $("#ipt").addEventListener("focus", handler);

      // click äº‹ä»¶ä¼šå‘ä¸Šå†’æ³¡
      $("#btn").addEventListener("click", handler);

      $("#div").addEventListener("click", function () {
        console.info("div çš„clickäº‹ä»¶è¢«è§¦å‘äº†");
      });
    </script>
  </body>
</html>
```

### [defaultPrevented](https://developer.mozilla.org/zh-CN/docs/Web/API/Event/defaultPrevented) åˆ¤æ–­å½“å‰äº‹ä»¶æ˜¯å¦è°ƒç”¨äº† preventDefault æ–¹æ³•

æ³¨æ„: å½“ `cancelbabel`ä¸º `false`æˆ–è€… `addEventListener`çš„ `options.passive`ä¸º `true`æ—¶, `preventDefault()`æ˜¯æ— æ³•å–æ¶ˆçš„

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>æµ‹è¯• Event å¯¹è±¡çš„ preventDefault å±æ€§</title>
  </head>
  <body>
    <div id="outter">
      <button id="btn1">btn1</button>
      <button id="btn2">btn2</button>
    </div>

    <script>
      document.querySelector("#outter").addEventListener("click", function (e) {
        if (e.target.id === "btn1") {
          // å¦‚æœç‚¹å‡»çš„æ˜¯ #btn1 å°±æ‰§è¡Œé˜»æ­¢é»˜è®¤äº‹ä»¶
          e.preventDefault();
        }
        console.info("æ˜¯å¦è°ƒç”¨äº† preventDefault: ", e.defaultPrevented);
      });
    </script>
  </body>
</html>
```

### [eventPhase](https://developer.mozilla.org/zh-CN/docs/Web/API/Event/eventPhase) å½“å‰äº‹ä»¶æµåœ¨å“ªä¸ªé˜¶æ®µ

![image.png](https://raw.githubusercontent.com/liaohui5/images/main/images/202311300135715.png)

### [isTrusted](https://developer.mozilla.org/zh-CN/docs/Web/API/Event/isTrusted): åˆ¤æ–­äº‹ä»¶æ˜¯ç”¨æˆ·äº¤äº’äº§ç”Ÿçš„, è¿˜æ˜¯ js è„šæœ¬æ‰‹åŠ¨åˆ›å»ºçš„

true: æ˜¯ç”¨æˆ·æ“ä½œäº§ç”Ÿçš„äº‹ä»¶
false: js è„šæœ¬åˆ›å»ºçš„äº‹ä»¶

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>æµ‹è¯• Event å¯¹è±¡çš„ isTrusted å±æ€§</title>
  </head>
  <body>
    <button id="btn">click me</button>

    <script>
      var btn = document.querySelector("#btn");
      btn.addEventListener("click", function (e) {
        console.info("isTrusted: ", e.isTrusted, e);
      });

      // è„šæœ¬åˆ›å»ºçš„äº‹ä»¶, æ‰‹åŠ¨è°ƒç”¨è§¦å‘, å¿…é¡»å…ˆæ·»åŠ ç›‘å¬å‡½æ•°, æ‰èƒ½è§¦å‘ç›‘å¬å‡½æ•°
      const event = document.createEvent("MouseEvent");
      event.initEvent("click");
      btn.dispatchEvent(event);
    </script>
  </body>
</html>
```

### [stopPropagation()](https://developer.mozilla.org/zh-CN/docs/Web/API/Event/stopPropagation) é˜»æ­¢é»˜è®¤äº‹ä»¶

åªæœ‰äº‹ä»¶çš„ `cancelable`ä¸º `true`å¹¶ä¸” `addEventListener`çš„ `options.passive`ä¸º false çš„æ—¶å€™æ‰å¯ä»¥é˜»æ­¢

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>æµ‹è¯• Event å¯¹è±¡çš„ stopProgation æ–¹æ³•</title>
  </head>
  <body>
    <form action="">
      <input type="text" id="ipt" />
      <button type="submit" id="submit-btn">submit form</button>
    </form>
    <script>
      function handler(e) {
        e.preventDefault();
        console.info("äº‹ä»¶æ˜¯å¦è¢«é˜»æ­¢: ", e.defaultPrevented, e);
      }

      // input: focus æ— æ³•è¢«é˜»æ­¢, å› ä¸º cancelable ä¸º false
      document.querySelector("#ipt").addEventListener("focus", handler);

      // form: submit æ— æ³•è¢«é˜»æ­¢, å› ä¸º addEventListener çš„ options.passive ä¸º true
      document.querySelector("#submit-btn").addEventListener("click", handler, {
        passive: true, // å¦‚æœæ˜¯ false å°±å¯ä»¥é˜»æ­¢è¡¨å•æäº¤, å› ä¸º click äº‹ä»¶çš„ cancalable ä¸º true
      });
    </script>
  </body>
</html>
```

### [stopImmediatePropagation()](https://developer.mozilla.org/zh-CN/docs/Web/API/Event/stopImmediatePropagation): é˜»æ­¢å…¶ä»–åç»­åŒç±»å‹çš„ç›‘å¬å‡½æ•°æ‰§è¡Œ

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>æµ‹è¯• Event å¯¹è±¡çš„ type å±æ€§</title>
    <style>
      .red {
        background: red;
      }
      .blue {
        background: blue;
      }
      .item {
        width: 100px;
        height: 100px;
      }
    </style>
  </head>
  <body>
    <div class="item red"></div>
    <div class="item blue"></div>
    <script>
      var red = document.querySelector(".red");
      var blue = document.querySelector(".blue");

      red.addEventListener("click", function (e) {
        console.info("red-click-1");
        // e.stopImmediatePropagation();
        // å¦‚æœåœ¨æ­¤å¤„æ‰§è¡Œ, åé¢æ·»åŠ çš„ click ç›‘å¬å‡½æ•°éƒ½ä¸ä¼šæ‰§è¡Œ
      });
      red.addEventListener("click", function (e) {
        console.info("red-click-2");
        e.stopImmediatePropagation();
        // å¦‚æœåœ¨æ­¤å¤„æ‰§è¡Œ, åé¢æ·»åŠ çš„ click ç›‘å¬å‡½æ•°éƒ½ä¸ä¼šæ‰§è¡Œ,
        // ä½†æ˜¯å‰é¢æ·»åŠ çš„ä¸å—å½±å“, æ­£å¸¸æ‰§è¡Œ
      });
      red.addEventListener("click", function () {
        console.info("red-click-3");
      });

      // ä¸é˜»æ­¢, ä¼šæŒ‰ç…§é¡ºåºæ·»åŠ ç›‘å¬å‡½æ•°å¹¶æ‰§è¡Œ
      blue.addEventListener("click", function () {
        console.info("blue-click-1");
      });
      blue.addEventListener("click", function () {
        console.info("blue-click-2");
      });
      blue.addEventListener("click", function () {
        console.info("blue-click-3");
      });
    </script>
  </body>
</html>
```
