## docker å‘½ä»¤äº†è§£

```sh
# 0.æŸ¥çœ‹ images
docker images

# 1.æ ¹æ®å½“å‰ç›®å½•ä¸‹çš„ Dockerfile æ‰“åŒ…
docker build -t my-vuejs-app .

# 2.å†æ¬¡æŸ¥çœ‹ images
docker images

# 3.æŸ¥çœ‹è¿è¡Œæ‰€æœ‰çš„å®¹å™¨
docker ps

# 4.è¿è¡Œ
docker run --name my-vuejs-app -p 80:80 443:443 -d my-vuejs-app

# 5.å†æ¬¡æŸ¥çœ‹è¿è¡Œæ‰€æœ‰çš„å®¹å™¨
docker ps

# 6.åœæ­¢å®¹å™¨
docker container stop my-vuejs-app

# 7.æŸ¥çœ‹æ‰€æœ‰å®¹å™¨(åŒ…æ‹¬å·²åœæ­¢çš„)
docker ps -a

# 8.åˆ é™¤å®¹å™¨
docker constainer rm  my-vuejs-app

# 9.å†æ¬¡æŸ¥çœ‹æ‰€æœ‰å®¹å™¨(åŒ…æ‹¬å·²åœæ­¢çš„)
docker ps -a

# 10.åˆ é™¤é•œåƒ
docker container rmi my-vuejs-app:latest

# 11.å†æ¬¡æŸ¥çœ‹æ‰€æœ‰é•œåƒ
docker images
```

## éƒ¨ç½²æ‰“åŒ…å¥½çš„é™æ€æ–‡ä»¶

å¦‚æœæ˜¯æ‰‹åŠ¨éƒ¨ç½², æ¨èè¿™ç§æ–¹å¼

è¿™é‡Œä»¥ vite æ„å»ºå·¥å…·åˆ›å»ºçš„é¡¹ç›®ä¸ºä¾‹, åŒ…æ‹¬ä½†ä¸é™äº `vue.js/react.js` é¡¹ç›®

- ä½¿ç”¨é»˜è®¤çš„ nginx é…ç½®æ–‡ä»¶

::: code-group

```txt [æ‰“åŒ…åçš„ç›®å½•ç»“æ„]
.
â”œâ”€â”€ Dockerfile    # Dockerfile
â”œâ”€â”€ README.md     # é¡¹ç›®è¯´æ˜æ–‡ä»¶
â”œâ”€â”€ dist          # é¡¹ç›®æ‰“åŒ…åçš„é™æ€æ–‡ä»¶
â”‚Â Â  â”œâ”€â”€ assets
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ index-653XRtVo.css
â”‚Â Â  â”‚Â Â  â””â”€â”€ index-C0gxKVtj.js
â”‚Â Â  â”œâ”€â”€ index.html
â”‚Â Â  â””â”€â”€ vite.svg
â””â”€â”€ docker-compose.yaml
```

```sh [æ‰“åŒ…é¡¹ç›®ç”¨çš„ shell è„šæœ¬]
#!/bin/bash
if [[ -d "./build" ]]; then
  rm -rf "./build"
fi

if [[ -f "./build.zip" ]]; then
  rm -rf "./build.zip"
fi

mkdir "./build"

npm run build

mv dist ./build/

cp Dockerfile docker-compose.yaml README.md ./build

zip ./build.zip -r ./build
```

```Dockerfile [Dockerfile]
FROM nginx:stable

WORKDIR /app
COPY . /app

RUN rm -rf /usr/share/nginx/html/index.html
RUN mv /app/dist/* /usr/share/nginx/html/

# nginx will use default config file: /etc/nginx/conf.d/default.conf

RUN echo "deploy completed"
```

```yaml [docker-compose.yaml]
services:
  app:
    build:
      context: "."
    container_name: app
    ports:
      - 8080:80
    restart: always
```

```sh [æ‰“åŒ…æµç¨‹ç¤ºä¾‹]
# 1. è¿›å…¥é¡¹ç›®ç›®å½•, æˆäºˆ build.sh æ‰§è¡Œæƒé™
chmod +x ./build.sh

# 2. æ‰§è¡Œæ‰“åŒ…è„šæœ¬
./build.sh

# 3. å°†æ–‡ä»¶ä¸Šä¼ åˆ°æœåŠ¡å™¨å¹¶è§£å‹,å¹¶è¿›å…¥ build ç›®å½•

# 4. ç”¨dockeréƒ¨ç½²
docker compose up -d
```

:::

## ä½¿ç”¨å®¹å™¨æ‰“åŒ…å¹¶éƒ¨ç½² VueJS é¡¹ç›®

è¿™ç§æ–¹å¼ä¸€èˆ¬ç”¨äº CI/CD(å¦‚ Github Action)

- æ‰“åŒ…éƒ¨ç½²å¹¶ä¸”ä½¿ç”¨è‡ªå®šä¹‰çš„nginxé…ç½®

::: code-group

```Dockerfile [Dockerfile]
### 1. ç”¨ node:lts-alpine é•œåƒæ¥æ‰“åŒ…é¡¹ç›®æ–‡ä»¶
FROM node:lts-alpine AS build-app

# è®¾ç½®å·¥ä½œç›®å½• & å°†é¡¹ç›®æ–‡ä»¶å¤åˆ¶åˆ°å®¹å™¨ä¸­
WORKDIR /app
COPY . /app

# è®¾ç½® npm æº(åŠ é€Ÿ)
RUN npm config set registry https://registry.npm.taobao.org

# å®‰è£…pnpm å®‰è£…é¡¹ç›®ä¾èµ– æ‰“åŒ…(æ€•å‡ºç°å¹»å½±ä¾èµ–çš„bug,æ‰€ä»¥ç”¨pnpm)
RUN npm install pnpm -g && \
  pnpm install --frozen-lockfile && \
  pnpm run build

# å¯ä»¥åœ¨è¿™é‡Œæ‰§è¡Œæµ‹è¯•åŸºæœ¬,æ£€æŸ¥ä»£ç çš„åŸºæœ¬é”™è¯¯
# RUN pnpm test

RUN echo "ğŸ‰ build completed"

### 2. ç”¨ nginx éƒ¨ç½²æ‰“åŒ…å¥½çš„æ–‡ä»¶
FROM nginx:stable AS deploy-app

# å°†éœ€è¦æ–‡ä»¶ä»ä¸Šä¸€ä¸ªæ‰“åŒ…æ­¥éª¤çš„å®¹å™¨ä¸­å¤åˆ¶åˆ°æœ¬å®¹å™¨
# dist       : é¡¹ç›®æ‰“åŒ…åçš„æ–‡ä»¶
# nginx.conf : nginx é…ç½®æ–‡ä»¶(æ”¾åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹)
# ssl_keys   : é…ç½® https éœ€è¦çš„è¯ä¹¦æ–‡ä»¶
COPY --from=build-app /app/dist       /usr/share/nginx/html/dist
COPY --from=build-app /app/nginx.conf /etc/nginx/nginx.conf

RUN echo "ğŸ‰ deploy completed"
```

``` [nginx.conf]
user  nginx;
worker_processes auto;

#error_log  /var/log/nginx/error.log;
#pid        /run/nginx.pid;

events {
    worker_connections 1024;
}

http {
    include /etc/nginx/mime.types;
    default_type application/octet-stream;
    access_log off;

    server {
        # set server name and listen port
        listen 80 default_server;
        server_name www.example.cn;

        # web root directory
        root /usr/share/nginx/html/dist;
        index index.html;

        # for vue-router history mode
        location / {
          try_files $uri $uri/ /index.html;
        }
    }
}
```

:::
