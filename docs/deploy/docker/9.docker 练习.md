---
outline: deep
---

## æ‰“åŒ…éƒ¨ç½² VueJS é¡¹ç›®

- Dockerfile

::: code-group

```Dockerfile [Dockerfile]
### 1. ç”¨ node:lts-alpine é•œåƒæ¥æ‰“åŒ…é¡¹ç›®æ–‡ä»¶
FROM node:lts-alpine AS build-app

# è®¾ç½®å·¥ä½œç›®å½• & å°†é¡¹ç›®æ–‡ä»¶å¤åˆ¶åˆ°å®¹å™¨ä¸­
WORKDIR /app
COPY . /app

# è®¾ç½® npm æº(åŠ é€Ÿ)
RUN npm config set registry https://registry.npm.taobao.org

# å®‰è£…pnpm å®‰è£…é¡¹ç›®ä¾èµ– æ‰“åŒ…(æ€•å‡ºç°å¹»å½±ä¾èµ–çš„bug,æ‰€ä»¥ç”¨pnpm)
RUN npm install pnpm -g && \
  pnpm install --frozen-lockfile && \
  pnpm run build

RUN echo "ğŸ‰ build completed"

### 2. ç”¨ nginx éƒ¨ç½²æ‰“åŒ…å¥½çš„æ–‡ä»¶
FROM nginx:stable AS deploy-app

# å°†éœ€è¦æ–‡ä»¶ä»ä¸Šä¸€ä¸ªæ‰“åŒ…æ­¥éª¤çš„å®¹å™¨ä¸­å¤åˆ¶åˆ°æœ¬å®¹å™¨
# dist       : é¡¹ç›®æ‰“åŒ…åçš„æ–‡ä»¶
# nginx.conf : nginx é…ç½®æ–‡ä»¶(æ”¾åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹)
# ssl_keys   : é…ç½® https éœ€è¦çš„è¯ä¹¦æ–‡ä»¶
COPY --from=build-app /app/dist       /usr/share/nginx/html/dist
COPY --from=build-app /app/nginx.conf /etc/nginx/nginx.conf

RUN echo "ğŸ‰ deploy completed"
```

``` [nginx.conf]
user  nginx;
worker_processes auto;

#error_log  /var/log/nginx/error.log;
#pid        /run/nginx.pid;

events {
    worker_connections 1024;
}

http {
    include /etc/nginx/mime.types;
    default_type application/octet-stream;
    access_log off;

    server {
        # set server name and listen port
        listen 80 default_server;
        server_name note.liaohui5.cn;

        # web root directory
        root /usr/share/nginx/html/dist;
        index index.html;

        # for vue-router history mode
        location / {
          try_files $uri $uri/ /index.html;
        }
    }
}
```

:::

- æ‰“åŒ…éƒ¨ç½²å‘½ä»¤

```sh
# 0.æŸ¥çœ‹ images
docker images

# 1.æ ¹æ®å½“å‰ç›®å½•ä¸‹çš„ Dockerfile æ‰“åŒ…
docker build -t my-vuejs-app .

# 2.å†æ¬¡æŸ¥çœ‹ images
docker images

# 3.æŸ¥çœ‹è¿è¡Œæ‰€æœ‰çš„å®¹å™¨
docker ps

# 4.è¿è¡Œ
docker run --name my-vuejs-app -p 80:80 443:443 -d my-vuejs-app

# 5.å†æ¬¡æŸ¥çœ‹è¿è¡Œæ‰€æœ‰çš„å®¹å™¨
docker ps

# 6.åœæ­¢å®¹å™¨
docker container stop my-vuejs-app

# 7.æŸ¥çœ‹æ‰€æœ‰å®¹å™¨(åŒ…æ‹¬å·²åœæ­¢çš„)
docker ps -a

# 8.åˆ é™¤å®¹å™¨
docker constainer rm  my-vuejs-app

# 9.å†æ¬¡æŸ¥çœ‹æ‰€æœ‰å®¹å™¨(åŒ…æ‹¬å·²åœæ­¢çš„)
docker ps -a

# 10.åˆ é™¤é•œåƒ
docker container rmi my-vuejs-app:latest

# 11.å†æ¬¡æŸ¥çœ‹æ‰€æœ‰é•œåƒ
docker images
```

## è¿è¡Œä¸€ä¸ª mysql å®¹å™¨

1. å°†é…ç½®æ–‡ä»¶å’Œæ•°æ®å·æŒ‚è½½åˆ°å®¹å™¨ä¸­
2. å…è®¸è¿œç¨‹è®¿é—®

### è·å¾—é»˜è®¤çš„é…ç½®æ–‡ä»¶å’Œæ•°æ®

```sh
# è¿è¡Œ
docker run -d \
--name mysql57 \
-p 3306:3306 \
-e MYSQL_ROOT_PASSWORD=root123456\
mysql:5.7

# å¤åˆ¶å®¹å™¨ä¸­çš„é»˜è®¤é…ç½®æ–‡ä»¶å’Œæ•°æ®
docker cp mysql57:/etc/mysql     ./mysql_conf
docker cp mysql57:/var/lib/mysql ./mysql_data

# åœæ­¢å¹¶åˆ é™¤å®¹å™¨
docker stop mysql57
docker rm mysql57
```

### å†æ¬¡è¿è¡Œ

```sh
docker run -d  \
--name mysql57 \
-p 3306:3306 \
-v $(pwd)/mysql_conf:/etc/mysql \
-v $(pwd)/mysql_data:/var/lib/mysql \
-e MYSQL_ROOT_PASSWORD=root123456 \
mysql:5.7

# æ³¨æ„ MYSQL_ROOT_PASSWORD æ˜¯ root ç”¨æˆ·çš„å¯†ç 
```

### è¿›å…¥å®¹å™¨å…è®¸è¿œç¨‹è®¿é—®

```sh
docker exec -it mysql57 /bin/bash

# é“¾æ¥æ•°æ®åº“
mysql -u root -p root123456

# å…è®¸ root è¿œç¨‹è®¿é—®, æ³¨æ„å¯†ç , mysql5èƒ½è¿™æ ·è®¾ç½®, mysql8æ— æ³•è¿™æ ·è®¾ç½®
# %è¡¨ç¤ºå…è®¸ä»»ä½•ipåœ°å€çš„ç”µè„‘ç”¨adminå¸æˆ·å’Œå¯†ç (123456)æ¥è®¿é—®, ä¹Ÿå¯ä»¥æŒ‡å®šip 'root'@'39.156.66.10'
grant all privileges on *.* to 'root'@'%' identified by 'root123456' with grant option;

# å…è®¸å…¶ä»–æ–°å»ºç”¨æˆ·è¿œç¨‹è®¿é—®
grant all on *.* to dev_user@'%' identified by '123456' with grant option;

# åˆ·æ–°æƒé™, è¿™ä¸ªæ­¥éª¤ä¸€å®šè¦åš, å¦åˆ™ä¸ç”Ÿæ•ˆ
flush privileges;

# é€€å‡º mysql å®¢æˆ·ç«¯ ctrl+d, ä½†æ˜¯æ³¨æ„ä¸è¦æ¨å‡ºå®¹å™¨

# åœ¨å®¹å™¨ä¸­é‡å¯ mysql æœåŠ¡
systemctl restart mysql

# é€€å‡ºå®¹å™¨
exit
```

## æœ€å

å…¶ä»–çš„å®¹å™¨ä¹Ÿå¯ä»¥è¿™æ ·æ“ä½œ, æ¯”å¦‚ redis, nginx, mariadb, mysql:8 ç­‰ç­‰, å…·ä½“å¯ä»¥æŸ¥çœ‹[dockerhub](https://hub.docker.com/search?q=mysql)çš„æ–‡æ¡£

1. çœ‹æ–‡æ¡£è·å–é»˜è®¤é…ç½®æ–‡ä»¶çš„ä½ç½®
2. è¿è¡Œå®¹å™¨
3. ä½¿ç”¨ `docker cp` å‘½ä»¤å¤åˆ¶é»˜è®¤çš„é…ç½®æ–‡ä»¶å’Œæ•°æ®(ä¸ä¸€å®šæ˜¯æ•°æ®åº“æ•°æ®,ä¹Ÿæœ‰å¯èƒ½æ˜¯æ—¥å¿—ç­‰å…¶ä»–æ•°æ®)
4. åœæ­¢å¹¶åˆ é™¤å®¹å™¨
5. ä¿®æ”¹é…ç½®æ–‡ä»¶, ç„¶åé‡å¯å®¹å™¨
